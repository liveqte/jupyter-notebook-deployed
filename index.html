<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>WebSocket 状态检测</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .status { font-size: 1.2em; margin-bottom: 10px; }
    .latency { font-size: 1.2em; color: green; }
  </style>
</head>
<body>
  <div class="status">连接状态：<span id="status">未连接</span></div>
  <div class="latency">延迟：<span id="latency">--</span> ms</div>

  <script>
    const statusEl = document.getElementById('status');
    const latencyEl = document.getElementById('latency');

    const wsProtocol = location.protocol === 'https:' ? 'wss' : 'ws';
    const routePrefix = location.pathname.split('/')[1]; // 提取第一层路径
    const wsPath = `/${routePrefix}/ws`;

    const ws = new WebSocket(`${wsProtocol}://${location.host}${wsPath}`);


    ws.onopen = () => {
      statusEl.textContent = '已连接';
      statusEl.style.color = 'green';
    };

    ws.onmessage = e => {
      const data = JSON.parse(e.data);
      if (data.type === 'ping') {
        ws.send(JSON.stringify({ type: 'pong', timestamp: data.timestamp }));
      } else if (data.type === 'latency') {
        latencyEl.textContent = data.latency;
      }
    };

    ws.onclose = () => {
      statusEl.textContent = '连接断开';
      statusEl.style.color = 'red';
      latencyEl.textContent = '--';
    };
  </script>
</body>
</html>
